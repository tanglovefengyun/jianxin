(()=>{"use strict";function e(e,t="POST",s,n,a="json"){var o;const i=n||{};const r=Object.assign({cache:"no-cache",headers:{},redirect:"follow",mode:"cors"},{method:t}),c=Object.assign(r,i);if(c.method=null===(o=c.method)||void 0===o?void 0:o.toUpperCase(),"GET"===c.method){if(s){let t="";const n=/([?&])_=[^&]*/,a=/\?/;"object"==typeof s&&(t=function(e){let t="";for(const s in e)e.hasOwnProperty(s)&&(t+=s+"="+encodeURIComponent(e[s])+"&");return t.slice(0,-1)}(s)),e=n.test(e)?e.replace(n,"$1"+t):e+(a.test(e)?"&":"?")+t}}else[FormData,ArrayBuffer,Blob].filter((e=>s instanceof e)).length>0?c.body=s:(c.headers=Object.assign({"Content-Type":"application/json"},c.headers),s&&(c.body="string"==typeof s?s:JSON.stringify(s)));return fetch(e,c).then((e=>{const{status:t}=e;if(t>=200&&t<400){let t;switch(a){case"json":t=new Promise((t=>{e.text().then((e=>{try{t(JSON.parse(e))}catch(s){t(e)}}))}));break;case"text":t=e.text();break;case"blob":t=e.blob();break;case"arraybuffer":t=e.arrayBuffer();break;default:t=e.json()}return t}return Promise.reject(e)})).catch((e=>Promise.reject(e)))}const t=(t,s,n,a)=>e(t,"POST",s,n,a);const s="webpushinfoData",n="webPushTable";function a(e){const t=indexedDB.open(s);t.onupgradeneeded=function(e){var t;const s=null===(t=e.target)||void 0===t?void 0:t.result;if(!s.objectStoreNames.contains(n)){s.createObjectStore(n,{keyPath:"id"}).createIndex("name","name",{unique:!1})}},t.onerror=function(){},t.onsuccess=function(){e(t.result)}}function o(e,t="userInfoData"){a((a=>{try{const s=a.transaction([n],"readonly"),o=s.objectStore(n).index("name");o.get(t).onsuccess=function(t){t.target.result?e(t.target.result):e({})}}catch(t){!function(e=s){const t=indexedDB.deleteDatabase(e);t.onsuccess=function(){},t.onerror=function(){}}(),e({})}}))}let i="",r={centerUrl:"https://global-websis.engagelab.com/v1/get-webaddr",prefix:".produce.min.3.3.2.js",version:"3.3.2",URL_POLLING:"",development:!1}.reportUrl,c=!1;function l(e){c?e(r):o((t=>{c=!0;const s=JSON.parse(t.data||"{}");s.reportUrl&&(r=s.reportUrl),e(r)}))}function u(e,s,n="W3Push"){s.mtpush_appkey&&(s.engagelab_appkey=s.mtpush_appkey),s.mtpush_passwd&&(s.engagelab_passwd=s.mtpush_passwd),s.mtpush_uid&&(s.engagelab_uid=s.mtpush_uid),e.forEach((e=>{const t=(new Date).getTime()/1e3|0;e.itime=t,e.msg_id&&(e.msg_id=e.msg_id.toString())}));const a={platform:"b",uid:Number(s.engagelab_uid),app_key:s.engagelab_appkey,channel:n,content:e};l((e=>{t(e,a,{headers:{Authorization:"Basic "+btoa(a.uid+":"+s.engagelab_passwd)}})}))}self.addEventListener("install",(function(){self.skipWaiting()})),self.addEventListener("message",(function(e){const s=e.data||{code:0,msg:{}};var n;"SET_OPEN_URL"===s.type&&s.value&&(i=s.value.openUrl),9965===s.code&&s.msg.reportUrl&&(r=s.msg.reportUrl),9999===s.code&&(n=s.msg,l((e=>{t(e,n.data,{headers:{Authorization:n.Authorization}})}))),6666===e.data.code&&(u([{type:"msg_status",msg_id:s.msg.msg_id,result:3018}],s.msg),u([{type:"msg_status",msg_id:s.msg.msg_id,result:3002}],s.msg),u([{type:"msg_status",msg_id:s.msg.msg_id,result:3001}],s.msg))})),self.addEventListener("activate",(function(){return self.clients.claim()})),self.addEventListener("notificationclick",(function(e){const t=e.notification.data;if(t){const s=e.action?e.action:"msgBody";self.clients.matchAll().then((e=>{e&&e.length&&e.forEach((e=>{e.postMessage({actionType:"click",data:Object.assign(Object.assign({},t),{position:s})})}))}));const n="MTPush"===(t.engagelab_mesg_type||t.mtpush_mesg_type)?"MTPush":"W3Push";u([{type:"msg_status",msg_id:e.notification.tag,result:3002}],t,n);let a=(null==t?void 0:t.engagelab_url)||(null==t?void 0:t.mtpush_url)||i||"";if(e.action&&t.engagelab_action_urls&&t.engagelab_action_urls[e.action]&&(a=t.engagelab_action_urls[e.action]),!a)return;if("Focus"===(null==t?void 0:t.engagelab_a_str)){const s=new URL(a).hostname;e.notification.close(),e.waitUntil(self.clients.matchAll({type:"window"}).then((e=>{let n;n="Exact"===(null==t?void 0:t.engagelab_m_str)?e.find((e=>new URL(e.url).href===a)):e.find((e=>new URL(e.url).hostname===s)),n?n.focus():self.clients.openWindow(a)})))}else e.notification.close(),e.waitUntil(self.clients.openWindow(a))}})),self.addEventListener("notificationclose",(function(e){})),self.addEventListener("push",(function(e){if(!e.data)return;const t=e.data.json();var s;if(t.locationTestDempWebPush52755665)self.registration.showNotification(t.title,t);else if(u([{type:"msg_status",msg_id:t.tag,result:3001}],t.data),self.clients.matchAll().then((e=>{e&&e.length&&e.forEach((e=>{e.postMessage(t)}))})),(s=t.data.ntf_or_msg)&&(1===s||3===s)){u([{type:"msg_status",msg_id:t.tag,result:3018}],t.data);const s=self.registration.showNotification(t.title,t);e.waitUntil(s)}}))})();